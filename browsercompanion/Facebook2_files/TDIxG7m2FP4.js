if (self.CavalryLogger) { CavalryLogger.start_js(["fHANF"]); }

__d("Keyframes",["Promise","Bootloader","Deferred","NavigationMetrics","XHRRequest","emptyFunction"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h="::",i={},j={},k=new(c("Deferred"))(),l="tti";c("NavigationMetrics").addRetroactiveListener(c("NavigationMetrics").Events.EVENT_OCCURRED,function(B,C){__p&&__p();var event=C.event;l=event;switch(event){case"tti":var D=k;k=new(c("Deferred"))();if(!D.isSettled())k.done(function(){return D.resolve()});break;case"e2e":k.resolve();break}});function m(){return k.then(function(){return new(c("Promise"))(function(B){c("Bootloader").loadModules(["KeyframesRenderer"],function(C){return B(C)},"Keyframes")})})}function n(){return k.then(function(){return new(c("Promise"))(function(B){c("Bootloader").loadModules(["FBKeyframesLoggedSession"],function(C){return B(C)},"Keyframes")})})}function o(){return k.then(function(){return new(c("Promise"))(function(B){c("Bootloader").loadModules(["KeyframesAssetDecoder"],function(C){return B(C)},"Keyframes")})})}function p(){return c("Promise").all([n(),o(),m()]).then(c("emptyFunction"))}function q(B){if(!B||typeof B!=="string")return c("Promise").reject("Request: invalid uri "+B);return k.then(function(){return new(c("Promise"))(function(C,D){new(c("XHRRequest"))(B).setMethod("GET").setResponseType("arraybuffer").setErrorHandler(function(E){return D(E)}).setAbortHandler(function(E){return D(E)}).setResponseHandler(function(E){return C(E)}).send()})})}function r(B){return i[B]!=null}function s(B){if(i[B]==null)i[B]=new y(B);return i[B]}function t(B){return j[B]!=null}function u(B){if(j[B]==null)j[B]=new z(B);return j[B]}function v(){return w(Date.now(),l)}function w(B,C){return{value:B,phase:C}}function x(B,C){this.$SessionStub1={start:C||v(),"package":false,utilized:false};this.$SessionStub3=n().then(function(D){var E=new D("network",B,this.$SessionStub1.start);this.$SessionStub4(E);return E}.bind(this));this.$SessionStub3.done(function(D){return this.$SessionStub2=D}.bind(this))}x.prototype.getSession=function(){return this.$SessionStub3};x.prototype.$SessionStub4=function(B){__p&&__p();if(this.$SessionStub1.assetRequest!=null){var C=B.startAssetRequest(this.$SessionStub1.assetRequest);if(this.$SessionStub1.assetRequestError!=null){C.error(this.$SessionStub1.assetRequestError);return}if(this.$SessionStub1.assetResponse!=null)C.loadedFromNetwork(this.$SessionStub1.assetResponse)}if(this.$SessionStub1.assetDecode!=null){var D=B.startAssetDecode(this.$SessionStub1.assetDecode);if(this.$SessionStub1.assetDecodeError!=null){D.error(this.$SessionStub1.assetDecodeError);return}if(this.$SessionStub1.finish!=null)D.finish(this.$SessionStub1.finish)}if(this.$SessionStub1.utilized)B.utilizeAsset();if(this.$SessionStub1["package"])B.markAsPackage()};x.prototype.startAssetDecode=function(B){__p&&__p();if(this.$SessionStub2)return this.$SessionStub2.startAssetDecode(B);else{this.$SessionStub1.assetDecode=B||v();return{finish:function(C){if(this.$SessionStub2)this.$SessionStub2.startAssetDecode(this.$SessionStub1.assetDecode).finish(C);else this.$SessionStub1.finish=C||v()}.bind(this),error:function(C){if(this.$SessionStub2)this.$SessionStub2.startAssetDecode(this.$SessionStub1.assetDecode).error(C);else this.$SessionStub1.assetDecodeError=C||v()}.bind(this)}}};x.prototype.startAssetRequest=function(B){__p&&__p();if(this.$SessionStub2)return this.$SessionStub2.startAssetRequest(B);else{this.$SessionStub1.assetRequest=B||v();var C=function(E){if(this.$SessionStub2)return this.$SessionStub2.startAssetRequest(this.$SessionStub1.assetRequest).loadedFromNetwork(E);else{this.$SessionStub1.assetResponse=E||v();return{startAssetDecode:this.startAssetDecode.bind(this)}}}.bind(this),D=function(E){if(this.$SessionStub2)this.$SessionStub2.startAssetRequest(this.$SessionStub1.assetRequest).error(E);else this.$SessionStub1.assetRequestError=E||v()}.bind(this);return{loadedFromCache:C,loadedFromNetwork:C,cancel:D,error:D}}};x.prototype.utilizeAsset=function(){if(this.$SessionStub2)this.$SessionStub2.utilizeAsset();else this.$SessionStub1.utilized=true};x.prototype.markAsPackage=function(){if(this.$SessionStub2)this.$SessionStub2.markAsPackage();else this.$SessionStub1["package"]=true};function y(B,C){__p&&__p();var D,E=this;this.$DecodedAssetRequest1=[];this.$DecodedAssetRequest3=[];this.$DecodedAssetRequest4=[];this.$DecodedAssetRequest5="requesting";this.$DecodedAssetRequest7=false;this.$DecodedAssetRequest6=B;if(C)(function(){var F=C.stubs,G=C.bytes;E.$DecodedAssetRequest5="decoding";E.$DecodedAssetRequest2=o().then(function(H){this.$DecodedAssetRequest1.push.apply(this.$DecodedAssetRequest1,F.map(function(I){return I.startAssetDecode()}));return this.$DecodedAssetRequest8(G,H)}.bind(E))})()}y.prototype.isLoaded=function(){return this.$DecodedAssetRequest5==="done"};y.prototype.getAsset=function(B){return this.$DecodedAssetRequest9(B)};y.prototype.getRenderer=function(B){return c("Promise").all([this.$DecodedAssetRequest9(B),B.getSession(),m()]).then(function(C){var D=C[0],E=C[1],F=C[2];this.$DecodedAssetRequest10();return new F(D,E.getPerformanceLogIfEnabled())}.bind(this))};y.prototype.$DecodedAssetRequest10=function(){if(!this.$DecodedAssetRequest7){this.$DecodedAssetRequest4.forEach(function(B){return B.utilizeAsset()});this.$DecodedAssetRequest7=true}};y.prototype.$DecodedAssetRequest9=function(B){__p&&__p();this.$DecodedAssetRequest4.push(B);if(this.$DecodedAssetRequest7)B.utilizeAsset();switch(this.$DecodedAssetRequest5){case"requesting":this.$DecodedAssetRequest3.push(B.startAssetRequest());break;case"decoding":this.$DecodedAssetRequest1.push(B.startAssetDecode());break}if(!this.$DecodedAssetRequest2){p();var C=c("Promise").all([q(this.$DecodedAssetRequest6),o()]).then(function(D){var E=D[0],F=D[1];while(this.$DecodedAssetRequest3.length)this.$DecodedAssetRequest1.push(this.$DecodedAssetRequest3.pop().loadedFromNetwork().startAssetDecode());return this.$DecodedAssetRequest8(E,F)}.bind(this));C["catch"](function(D){this.$DecodedAssetRequest3.forEach(function(E){return E.error()});this.$DecodedAssetRequest5="error"}.bind(this));this.$DecodedAssetRequest2=C}return this.$DecodedAssetRequest2};y.prototype.$DecodedAssetRequest8=function(B,C){__p&&__p();this.$DecodedAssetRequest5="decoding";var D=C.fromDocumentBytes(B);D.done(function(){this.$DecodedAssetRequest5="done";this.$DecodedAssetRequest1.forEach(function(E){return E.finish()});this.$DecodedAssetRequest11()}.bind(this),function(){this.$DecodedAssetRequest5="error";this.$DecodedAssetRequest1.forEach(function(E){return E.error()})}.bind(this));return D};y.prototype.$DecodedAssetRequest11=function(){this.$DecodedAssetRequest3.length=0;this.$DecodedAssetRequest1.length=0};function z(B){this.$PackageRequest1=[];this.$PackageRequest2=[];this.$PackageRequest4="requesting";p();this.$PackageRequest3=this.$PackageRequest5(B)}z.prototype.isLoaded=function(){return this.$PackageRequest4==="done"};z.prototype.getDecodedAssetRequests=function(B){this.$PackageRequest6(B).getSession();return this.$PackageRequest3};z.prototype.getRenderer=function(B,C){__p&&__p();if(B<0)return c("Promise").reject("Package request: out of bounds index "+B+" "+("for "+C.projectName+" "+C.packageName));var D=this.$PackageRequest6(C),E=this.$PackageRequest7(B,C);m();D.getSession();return c("Promise").all([this.$PackageRequest3,E]).then(function(F){var G=F[0],H=F[1],I=G[B].getRenderer(H);I.done(function(){return D.utilizeAsset()});return I})};z.prototype.$PackageRequest6=function(B){var C=v(),D=new x({projectName:B.projectName,assetName:B.packageName},C);D.markAsPackage();if(this.$PackageRequest4==="requesting")this.$PackageRequest2.push({log:D.startAssetRequest(C),timestamp:C});if(this.$PackageRequest4==="error")D.startAssetRequest(C).error();return D};z.prototype.$PackageRequest7=function(B,C){__p&&__p();var D=v(),E={projectName:C.projectName,assetName:C.packageName+h+C.assetName};if(this.$PackageRequest4==="requesting"){var F={metadata:E,timestamp:D,deferredSessionStub:new(c("Deferred"))()};if(!this.$PackageRequest1[B])this.$PackageRequest1[B]=[];this.$PackageRequest1[B].push(F);return F.deferredSessionStub.getPromise()}var G=new x(E,D);if(this.$PackageRequest4==="error")G.startAssetRequest(D).error();return c("Promise").resolve(G)};z.prototype.$PackageRequest5=function(B){__p&&__p();var C=c("Promise").all([o(),this.$PackageRequest8(B)]).then(function(D){__p&&__p();var E=D[0],F=D[1],G=F.endTime.value-F.startTime.value,H=F.documentSlices.map(function(L){return L.byteLength/F.byteLength}).map(function(L){return L*G}),I=H.map(function(L){return L/G}),J=G-H.reduce(function(L,M){return L+=M},0),K=J/G;this.$PackageRequest9(K,F.endTime);this.$PackageRequest10(F.documentSlices.length);return F.documentSlices.map(function(L,M){var N=this.$PackageRequest11(M,I[M],F.endTime);return new y("",{bytes:L,stubs:N})}.bind(this))}.bind(this));C["catch"](function(D){this.$PackageRequest4="error";this.$PackageRequest1.forEach(function(E){E.forEach(function(F){return F.deferredSessionStub.reject("Package decode error: "+D)})})}.bind(this)).done(function(){this.$PackageRequest4="done";this.$PackageRequest12()}.bind(this));return C};z.prototype.$PackageRequest8=function(B){__p&&__p();var C=v(),D=q(B),E=D.then(function(H){return{startTime:C,endTime:v(),byteLength:H.byteLength}}),F=c("Promise").all([o(),D]).then(function(H){var I=H[0],J=H[1];return I.getDocumentByteSlicesFromPackage(J)}),G=c("Promise").all([E,F]).then(function(H){var I=H[0],J=H[1];return babelHelpers["extends"]({},I,{documentSlices:J})});G["catch"](function(H){this.$PackageRequest4="error";this.$PackageRequest2.forEach(function(I){return I.log.error()});this.$PackageRequest1.forEach(function(I){I.forEach(function(J){return J.deferredSessionStub.reject("Package request error: "+H)})});this.$PackageRequest12()}.bind(this));return G};z.prototype.$PackageRequest9=function(B,C){this.$PackageRequest2.forEach(function(D){var E=C.value-D.timestamp.value,F=B*E+D.timestamp.value;D.log.loadedFromNetwork(w(F,C.phase)).startAssetDecode(C).finish(v())})};z.prototype.$PackageRequest11=function(B,C,D){return(this.$PackageRequest1[B]||[]).map(function(E){var F=D.value-E.timestamp.value,G=C*F,H=new x(E.metadata,E.timestamp);H.startAssetRequest(E.timestamp).loadedFromNetwork(w(E.timestamp.value+G,E.timestamp.phase));E.deferredSessionStub.resolve(H);return H})};z.prototype.$PackageRequest10=function(B){this.$PackageRequest1.slice(B).forEach(function(C){C.forEach(function(D,E){var F=D.deferredSessionStub,G=D.metadata;F.reject("Package decode: out of bounds index "+E+" "+("for "+G.projectName+" "+G.assetName))})})};z.prototype.$PackageRequest12=function(){this.$PackageRequest1=[];this.$PackageRequest2=[]};var A={requestDecodedAssetOnly:function B(C,D){return s(C).getAsset(new x(D))},requestRenderer:function B(C,D){return s(C).getRenderer(new x(D))},requestRendererFromPackage:function B(C,D,E){return u(C).getRenderer(D,E)},preloadPackage:function B(C,D){return u(C).getDecodedAssetRequests(D).then(c("emptyFunction"))},hasLoaded:function B(C){return r(C)&&s(C).isLoaded()||t(C)&&u(C).isLoaded()},clearCache:function B(){i={};j={}}};f.exports=A}),null);
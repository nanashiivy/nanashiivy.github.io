<!DOCTYPE html>

<html data-wf-page="5a0846b98e7d0400017c3849" data-wf-site="5a01ab46079aa40001b46581">
<head>
  <meta charset="utf-8">
  <title>Your Score</title>
  <meta content="Your Score" property="og:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/visa-application-portal.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Ubuntu:300,300italic,400,400italic,500,500italic,700,700italic"]  }});</script>
  <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="https://daks2k3a4ib2z.cloudfront.net/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="https://daks2k3a4ib2z.cloudfront.net/img/webclip.png" rel="apple-touch-icon">
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
  <link rel="stylesheet" href="https://rawgit.com/tpreusse/radar-chart-d3/master/src/radar-chart.css">
	<script type="text/javascript" src="http://d3js.org/d3.v2.min.js"></script>
	<script src="http://d3js.org/d3.v3.js"></script>
	<script src="radarchart.js"></script>

  <style>
	#power-gauge g.arc {
		fill: steelblue;
	}

	#power-gauge g.pointer {
		fill: #0B0C0C;
		stroke: #0B0C0C;
	}
	
	#power-gauge g.label text {
		text-anchor: middle;
		font-size: 14px;
		font-weight: bold;
		fill: #666;
	}


	.radar-chart .area {
	  fill-opacity: 0.7;
	}
	.radar-chart.focus .area {
	  fill-opacity: 0.3;
	}

	.area.breakdown, .breakdown .circle { 
	  fill: #0C5FA3;
	  stroke: none;
	}
	</style>
</head>


<body class="body">
<!--   <div data-ix="new-interaction" class="loader">
    <h2 class="heading-5">Please wait while your data is being analysed</h2>
    <div class="container-4 w-container"><img src="images/loader.gif" class="image-19"></div>
  </div> -->
  <div class="section">
    <div data-collapse="medium" data-animation="default" data-duration="400" class="navbar w-nav">
      <div class="w-container"><a href="index.html" class="w-nav-brand"><img src="images/govukLogo.png" height="27" srcset="images/govukLogo-p-500.png 500w, images/govukLogo-p-800.png 800w, images/govukLogo-p-1080.png 1080w, images/govukLogo.png 1934w" sizes="157.28125px" class="image-2"></a>
        <div class="w-nav-button">
          <div class="w-icon-nav-menu"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-2 w-container">
    <div class="div-block"></div>
  </div>
  <div>
    <div class="w-container">
      <h1 class="heading-9" id="welcome" ></h1>
      <h2 class="heading-8" id="eligibility" ></h2>
      <div class="div-block-26 w-clearfix">
        <!-- <div class="div-block-25"></div> -->
        <div class="div-block-23"></div>
      </div>
    </div>
  </div>
  <div>
    <div class="w-container">
      <!-- <h3 class="heading-6">Your social credit score</h3> -->
      <div id="power-gauge" class="div-block-27"></div>
      <div>
        <div class="text-block-6">This is your current UK Integration Score (UKIS), which is calculated based on your digital profiles and online activities. You can always add more accounts to your application later, and improve your score.</div>
      </div>
    </div>
  </div>
  <div class="section-5">
    <div class="w-container">
      <h3 class="heading-7">Breakdown of your score</h3>
      <div>In order to maintain the fairness of the application system, the details of how a UKIS is calculated is not revealed to the public. We do, however, provide a rough breakdown to help you understand what is taken into consideration.</div>
      <div id="radar-chart" class="html-embed-2 w-embed w-script">
    </div>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
<script>

	var maxVal = 900;
	var minVal = 100;

var gauge = function(container, configuration) {
	var that = {};
	var config = {
		size						: 500, //200
		clipWidth					: 500, //200
		clipHeight					: 110,
		ringInset					: 5, //20
		ringWidth					: 20,
		
		pointerWidth				: 10,
		pointerTailLength			: 5,
		pointerHeadLengthPercent	: 0.9,
		
		minValue					: minVal,
		maxValue					: maxVal,
		
		minAngle					: -110,
		maxAngle					: 110,
		
		transitionMs				: 750,
		
		majorTicks					: 10, //number of arcs
		labelFormat					: d3.format('g'),
		labelInset					: 0, // position of labels 
		
		arcColorFn					: d3.interpolateHsl(d3.rgb('#E35A1A'), d3.rgb('#7CE900')) //colour gradient
	};
	var range = undefined;
	var r = undefined;
	var pointerHeadLength = undefined;
	var value = 0;
	
	var svg = undefined;
	var arc = undefined;
	var scale = undefined;
	var ticks = undefined;
	var tickData = undefined;
	var pointer = undefined;

	var donut = d3.layout.pie();
	
	function deg2rad(deg) {
		return deg * Math.PI / 180;
	}
	
	function newAngle(d) {
		var ratio = scale(d);
		var newAngle = config.minAngle + (ratio * range);
		return newAngle;
	}
	
	function configure(configuration) {
		var prop = undefined;
		for ( prop in configuration ) {
			config[prop] = configuration[prop];
		}
		
		range = config.maxAngle - config.minAngle;
		r = config.size / 2;
		
		pointerHeadLength = Math.round(r * config.pointerHeadLengthPercent);

		// a linear scale that maps domain values to a percent from 0..1
		scale = d3.scale.linear()
			.range([0,1])
			.domain([config.minValue, config.maxValue]);
			
		ticks = scale.ticks(config.majorTicks);
		tickData = d3.range(config.majorTicks).map(function() {return 1/config.majorTicks;});
		
		arc = d3.svg.arc()
			.innerRadius(r - config.ringWidth - config.ringInset)
			.outerRadius(r - config.ringInset)
			.startAngle(function(d, i) {
				var ratio = d * i;
				return deg2rad(config.minAngle + (ratio * range));
			})
			.endAngle(function(d, i) {
				var ratio = d * (i+1);
				return deg2rad(config.minAngle + (ratio * range));
			});
	}
	that.configure = configure;
	
	function centerTranslation() {
		return 'translate('+250 +','+ 230+')';
	}
	
	function isRendered() {
		return (svg !== undefined);
	}
	that.isRendered = isRendered;
	
	function render(newValue) {
		var h = 350;
		svg = d3.select(container)
			.append('svg:svg')
				.attr('class', 'gauge')
				.attr('width', config.clipWidth)
				.attr('height', h);



		
		var centerTx = centerTranslation(); // WTF is this?????
		
		//This is the chart itself
		var arcs = svg.append('g')
				.attr('class', 'arc')
				.attr('transform', centerTx)
				.attr('x', 100);


		
		arcs.selectAll('path')
				.data(tickData)
			.enter().append('path')
				.attr('fill', function(d, i) {
					return config.arcColorFn(d * i);
				})
				.attr('d', arc);
		
		var lg = svg.append('g')
				.attr('class', 'label')
				.attr('transform', centerTx);
		lg.selectAll('text')
				.data(ticks)
			.enter().append('text')
				.attr('transform', function(d) {
					var ratio = scale(d);
					var newAngle = config.minAngle + (ratio * range);
					return 'rotate(' +newAngle +') translate(0,' +(config.labelInset - r) +')';
				})
				.text(config.labelFormat);

		var lineData = [ [config.pointerWidth / 2, 0], 
						[0, -pointerHeadLength],
						[-(config.pointerWidth / 2), 0],
						[0, config.pointerTailLength],
						[config.pointerWidth / 2, 0] ];
		var pointerLine = d3.svg.line().interpolate('monotone');
		var pg = svg.append('g').data([lineData])
				.attr('class', 'pointer')
				.attr('transform', centerTx);
				
		pointer = pg.append('path')
			.attr('d', pointerLine/*function(d) { return pointerLine(d) +'Z';}*/ )
			.attr('transform', 'rotate(' +config.minAngle +')');
			
		update(newValue === undefined ? 0 : newValue);


		// This is the text


		var scoreText = svg.append("text")
	       		.text(Math.round(newValue))
	       		.attr("x", (config.clipWidth/2))             
	      		.attr("y", h -50)
	      		.style("font-size", "62px") 
	      		.attr("text-anchor", "middle")  
	      		// .style('fill', '#0c5fa3')
	      		.style("font-weight", "bold")


	    var valText;

		if (newValue < 300) {
		  	valText = "Your score is poor";
		  }
		  else if (newValue > 299 && newValue < 400) {
		  	valText = "Your score is fair";
		  }
		  else if (newValue > 399 && newValue < 500) {
		  	valText = "Your score is average";
		  }
		  else if (newValue > 499 && newValue < 600) {
			valText = "Your score is average";
		  }
		  else if (newValue > 599 && newValue < 700) {
		  	valText = "Your score is good";
		  }
		  else {
		  	valText = "Your score is excellent";
		  }

	    var valueText = svg.append("text")
	       		.text(valText)
	       		.attr("x", (config.clipWidth/2))             
	      		.attr("y", h-20)
	      		.style("font-size", "26px") 
	      		.attr("text-anchor", "middle")  
	      		// .style('fill', '#0c5fa3')
	      		// .style("font-weight", "bold")

	}





	that.render = render;
	
	function update(newValue, newConfiguration) {
		if ( newConfiguration  !== undefined) {
			configure(newConfiguration);
		}
		var ratio = scale(newValue);
		var newAngle = config.minAngle + (ratio * range);
		pointer.transition()
			.duration(config.transitionMs)
			.ease('elastic')
			.attr('transform', 'rotate(' +newAngle +')');
	}
	that.update = update;

	configure(configuration);
	
	return that;
};




function onDocumentReady() {

	var powerGauge = gauge('#power-gauge', {
		size: 400, //size of the gauge itself
		clipWidth: 500,
		clipHeight: 500,
		ringWidth: 30,
		maxValue: maxVal,
		transitionMs: 4000,
	});
	
	
	//new stuff
	var mapScore = d3.scale.linear()
		.domain([0, 1])
		.range([200, 800])

	var totalScore = mapScore(Math.random()); //this is the variable you will access in the other part of your code where you are drawing the breakdown

	powerGauge.render(totalScore);

	dataPrep(totalScore) //instead of 100 it should be the special random number generated in your above total score GAUGE thing

	function updateReadings() {
		// just pump in random data here...
		powerGauge.update(totalScore);
	}
	
	// every few seconds update reading values
	updateReadings();
	setInterval(function() {
		updateReadings();
	}, 5 * 1000);
}

if ( !window.isLoaded ) {
	window.addEventListener("load", function() {
		onDocumentReady();
	}, false);
} else {
	onDocumentReady();
}








RadarChart.defaultConfig.color = function() {};
RadarChart.defaultConfig.radius = 1;
RadarChart.defaultConfig.w = 600;
RadarChart.defaultConfig.h = 550;



function dataPrep(totalScore){
  var totalScore = totalScore;
  var minBrVal;
  var maxBrVal;
  console.log(totalScore);
  saveScore()
  
  if (totalScore < 300) {
  	minBrVal = 100;
	maxBrVal = 200;
  }
  else if (totalScore > 299 && totalScore < 400) {
  	minBrVal = 200;
	maxBrVal = 300;
  }
  else if (totalScore > 399 && totalScore < 500) {
  	minBrVal = 300;
	maxBrVal = 400;
  }
  else if (totalScore > 499 && totalScore < 600) {
  	minBrVal = 400;
	maxBrVal = 500;
  }
  else if (totalScore > 599 && totalScore < 700) {
  	minBrVal = 500;
	maxBrVal = 600;
  }
  else {
  	minBrVal = 600;
	maxBrVal = 700;
  }


	var mapBrScore = d3.scale.linear()
		.domain([0, 1])
		.range([minBrVal, maxBrVal])

	


  var data = [
    {
      className: 'breakdown',
      axes: [
        {axis: "Health consciousness", value: mapBrScore(Math.random())}, //shoudl be divided by randomThing 
        {axis: "Leisure activities", value: mapBrScore(Math.random())}, 
        {axis: "Community engagement", value: mapBrScore(Math.random())},  
        {axis: "Social relationships", value: mapBrScore(Math.random())},  
        {axis: "Shopping behaviour", value: mapBrScore(Math.random())}
      ]
    }
  ];

  function saveScore() {
		// window.sessionStorage.setItem("sessionScore", totalScore);
		// console.log(sessionStorage.getItem("sessionScore"));
		var savedName = sessionStorage.getItem("sessionName");
		console.log(savedName);
		
		if (totalScore < 500) {
			document.getElementById("eligibility").innerHTML = "You are unable to apply for a UK visa at this time"	
			document.getElementById("welcome").innerHTML = "Sorry, " + savedName;
			eligibility.style.color = "Red";
		}
		else {
			document.getElementById("eligibility").innerHTML = "You are eligible to apply for a UK visa"		
			document.getElementById("welcome").innerHTML = "Congratulations, " + savedName;
			eligibility.style.color = "green";
		}
		
}
  function randomDataset() {
    return data.map(function(d) {
      return {
        className: d.className,
        axes: d.axes.map(function(axis) {
          // console.log(d.axes.value)
          return {axis: axis.axis, value: axis.value}; // creates random value per axis
        })
      };
    });
  }

  var chart = RadarChart.chart();
  var cfg = chart.config(); // retrieve default config
  var svg = d3.select("#radar-chart").append('svg')
    .attr('width', cfg.w )
    .attr('height', cfg.h)

  svg.append('g').classed('single', 1).datum(randomDataset()).call(chart);

}

</script>
</body>
</html>